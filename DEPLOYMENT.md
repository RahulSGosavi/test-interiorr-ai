# Deployment Guide - Annotation AI Suite

## Quick Start: Deploy to Render

The fastest way to deploy is using Render's Blueprint feature:

1. **Push your code to GitHub**
2. **Go to [Render Dashboard](https://dashboard.render.com)**
3. **Click "New" â†’ "Blueprint"**
4. **Connect your GitHub repository**
5. **Render will auto-detect `render.yaml`**
6. **Set environment variables:**
   - `MONGO_URL`: Your MongoDB connection string
   - `EMERGENT_LLM_KEY`: Your Emergent LLM key
   - `REACT_APP_BACKEND_URL`: `https://YOUR-APP-NAME.onrender.com` (will be provided after first deploy)
7. **Click "Apply" to deploy**

**Deployment Commands:**
- **Build Command**: `bash render-build.sh` (automatically set in render.yaml)
- **Start Command**: `bash render-start.sh` (automatically set in render.yaml)

The app will be available at `https://YOUR-APP-NAME.onrender.com` after deployment completes (5-10 minutes).

---

## Prerequisites

1. MongoDB database (MongoDB Atlas recommended)
2. Environment variables configured
3. Emergent LLM Key or OpenAI/Gemini API keys

## Environment Variables

Create these environment variables in your deployment platform:

### Required:
- `MONGO_URL` - MongoDB connection string
- `DB_NAME` - Database name (default: annotation_db)
- `SECRET_KEY` - JWT secret key (auto-generated by Render, or generate a secure random string)
- `REACT_APP_BACKEND_URL` - Backend API URL (e.g., https://your-app.onrender.com)
- `EMERGENT_LLM_KEY` - Universal LLM key for OpenAI, Gemini, Claude

### Optional:
- `ACCESS_TOKEN_EXPIRE_MINUTES` - JWT expiration (default: 43200 = 30 days)
- `CORS_ORIGINS` - Allowed CORS origins (default: *)
- `UPLOAD_DIR` - File upload directory (default: backend/uploads, configured in render.yaml)
- `OPENAI_API_KEY` - OpenAI API key (if not using Emergent LLM Key)
- `GEMINI_API_KEY` - Gemini API key (if not using Emergent LLM Key)
- `PORT` - Server port (automatically set by Render, default: 10000)

---

## Deploy to Render

### Quick Deploy (Recommended)

1. **Push to GitHub**:
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin YOUR_GITHUB_REPO_URL
   git push -u origin main
   ```

2. **Create MongoDB Atlas Database**:
   - Go to [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
   - Create free cluster
   - Get connection string (replace `<password>` with your password)
   - Whitelist all IPs: `0.0.0.0/0`

3. **Deploy on Render**:
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click "New" â†’ "Blueprint"
   - Connect your GitHub repository
   - Render auto-detects `render.yaml`
   - Set required environment variables:
     * `MONGO_URL`: `mongodb+srv://user:password@cluster.mongodb.net/`
     * `EMERGENT_LLM_KEY`: Your Emergent LLM key
     * `REACT_APP_BACKEND_URL`: `https://YOUR-APP-NAME.onrender.com`
   - Click "Apply" to deploy

4. **Post-Deployment**:
   - Wait 5-10 minutes for build to complete
   - Visit `https://YOUR-APP-NAME.onrender.com`
   - Create account and start using!

### Important Notes:
- Free tier sleeps after 15 min inactivity (first request takes ~30s to wake)
- Upgrade to paid plan for always-on service
- Files stored on disk will persist with disk mount

### Method 2: Manual Setup

1. Create a new Web Service
2. Connect your repository
3. Configure:
   - **Build Command**: `bash render-build.sh`
   - **Start Command**: `bash render-start.sh`
   - **Plan**: Starter or higher
4. Add environment variables (see above)
5. Add a disk at `/opt/render/project/src/backend/uploads` (10GB recommended)
6. Deploy

**Post-deployment:**
- Update `REACT_APP_BACKEND_URL` environment variable to match your Render URL (e.g., `https://YOUR-APP-NAME.onrender.com`)
- Redeploy if needed

---

## Deploy to Railway

### Using railway.json (Recommended)

1. Install Railway CLI: `npm i -g @railway/cli`
2. Login: `railway login`
3. Initialize: `railway init`
4. Link MongoDB:
   - `railway add` â†’ Select MongoDB
   - Railway will auto-configure `MONGO_URL`
5. Set environment variables:
   ```bash
   railway variables set SECRET_KEY="your-secret-key"
   railway variables set DB_NAME="interior_design_db"
   railway variables set EMERGENT_LLM_KEY="your-llm-key"
   railway variables set REACT_APP_BACKEND_URL="https://your-app.railway.app"
   ```
6. Deploy: `railway up`

### Using Railway Dashboard

1. Go to [Railway Dashboard](https://railway.app/dashboard)
2. Create new project â†’ "Deploy from GitHub"
3. Connect repository
4. Add MongoDB service:
   - Click "+ New" â†’ "Database" â†’ "Add MongoDB"
   - Railway auto-configures connection
5. Configure main service:
   - Add environment variables (see above)
   - Railway will auto-detect build settings from `railway.json`
6. Deploy

**Post-deployment:**
- Get your Railway URL from the dashboard
- Update `REACT_APP_BACKEND_URL` to match your Railway domain
- Redeploy if needed

---

## Deploy with Docker

### Build and Run Locally

```bash
# Build image
docker build -f Dockerfile.production -t interior-design-suite .

# Run container
docker run -d \
  -p 8001:8001 \
  -p 3000:3000 \
  -e MONGO_URL="your-mongodb-url" \
  -e DB_NAME="interior_design_db" \
  -e SECRET_KEY="your-secret-key" \
  -e EMERGENT_LLM_KEY="your-llm-key" \
  -e REACT_APP_BACKEND_URL="http://localhost:8001" \
  -v $(pwd)/uploads:/app/uploads \
  interior-design-suite
```

### Deploy to Any Cloud Provider

1. Build and push to container registry:
   ```bash
   docker build -f Dockerfile.production -t your-registry/interior-design-suite .
   docker push your-registry/interior-design-suite
   ```

2. Deploy container with environment variables on:
   - AWS ECS
   - Google Cloud Run
   - Azure Container Instances
   - DigitalOcean App Platform

---

## MongoDB Setup (MongoDB Atlas)

1. Create account at [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2. Create a free cluster
3. Create database user:
   - Go to "Database Access"
   - Add new user with password
4. Whitelist IP:
   - Go to "Network Access"
   - Add IP Address: `0.0.0.0/0` (allow from anywhere)
5. Get connection string:
   - Click "Connect" on your cluster
   - Choose "Connect your application"
   - Copy connection string
   - Replace `<password>` with your user password
6. Use this as `MONGO_URL` environment variable

---

## Post-Deployment Checklist

âœ… MongoDB database accessible  
âœ… All environment variables set  
âœ… File uploads working (check disk/volume mounted)  
âœ… Backend API responding at `/api/auth/me`  
âœ… Frontend loading correctly  
âœ… User signup/login working  
âœ… PDF upload and annotation working  
âœ… Pricing AI queries working  

---

## Troubleshooting

### Backend won't start
- Check `MONGO_URL` is correct and database is accessible
- Verify `SECRET_KEY` is set
- Check logs for Python errors

### Frontend not loading
- Verify `REACT_APP_BACKEND_URL` matches your backend URL
- Check CORS settings if frontend and backend on different domains
- Rebuild frontend after environment variable changes

### Pricing AI errors
- Ensure `EMERGENT_LLM_KEY` is set correctly
- Check backend logs for API errors
- Verify network access to LLM APIs

### File uploads failing
- Ensure upload directory exists and is writable
- Check disk/volume is properly mounted
- Verify sufficient storage space

---

## Support

For issues or questions:
1. Check application logs
2. Verify all environment variables
3. Test MongoDB connection separately
4. Review error messages in browser console

**The app is now deployment-ready for any platform! ðŸš€**
